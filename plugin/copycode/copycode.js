(function(p,g){typeof exports=="object"&&typeof module<"u"?module.exports=g():typeof define=="function"&&define.amd?define(g):(p=typeof globalThis<"u"?globalThis:p||self,p.CopyCode=g())})(this,function(){"use strict";var p=typeof document<"u"?document.currentScript:null;const g={button:"always",display:"text",text:{copy:"Copy",copied:"Copied!"},plaintextonly:!0,timeout:1e3,style:{copybg:"orange",copiedbg:"green",copycolor:"black",copiedcolor:"white",copyborder:"",copiedborder:"",scale:1,offset:0,radius:0},tooltip:!0,iconsvg:{copy:"",copied:""},cssautoload:!0,csspath:""};function I(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var $,v;function O(){if(v)return $;v=1;var o=function(l){return e(l)&&!t(l)};function e(n){return!!n&&typeof n=="object"}function t(n){var l=Object.prototype.toString.call(n);return l==="[object RegExp]"||l==="[object Date]"||c(n)}var r=typeof Symbol=="function"&&Symbol.for,s=r?Symbol.for("react.element"):60103;function c(n){return n.$$typeof===s}function h(n){return Array.isArray(n)?[]:{}}function u(n,l){return l.clone!==!1&&l.isMergeableObject(n)?x(h(n),n,l):n}function m(n,l,i){return n.concat(l).map(function(S){return u(S,i)})}function d(n,l){if(!l.customMerge)return x;var i=l.customMerge(n);return typeof i=="function"?i:x}function a(n){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(n).filter(function(l){return Object.propertyIsEnumerable.call(n,l)}):[]}function f(n){return Object.keys(n).concat(a(n))}function C(n,l){try{return l in n}catch{return!1}}function j(n,l){return C(n,l)&&!(Object.hasOwnProperty.call(n,l)&&Object.propertyIsEnumerable.call(n,l))}function A(n,l,i){var S={};return i.isMergeableObject(n)&&f(n).forEach(function(y){S[y]=u(n[y],i)}),f(l).forEach(function(y){j(n,y)||(C(n,y)&&i.isMergeableObject(l[y])?S[y]=d(y,i)(n[y],l[y],i):S[y]=u(l[y],i))}),S}function x(n,l,i){i=i||{},i.arrayMerge=i.arrayMerge||m,i.isMergeableObject=i.isMergeableObject||o,i.cloneUnlessOtherwiseSpecified=u;var S=Array.isArray(l),y=Array.isArray(n),V=S===y;return V?S?i.arrayMerge(n,l,i):A(n,l,i):u(l,i)}x.all=function(l,i){if(!Array.isArray(l))throw new Error("first argument should be an array");return l.reduce(function(S,y){return x(S,y,i)},{})};var w=x;return $=w,$}var D=O();const R=I(D);var q=Object.defineProperty,U=(o,e,t)=>e in o?q(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,b=(o,e,t)=>U(o,typeof e!="symbol"?e+"":e,t);class P{constructor(e,t,r){b(this,"defaultConfig"),b(this,"pluginInit"),b(this,"pluginId"),b(this,"mergedConfig",null),b(this,"data",{}),typeof e=="string"?(this.pluginId=e,this.pluginInit=t,this.defaultConfig=r||{}):(this.pluginId=e.id,this.pluginInit=e.init,this.defaultConfig=e.defaultConfig||{})}initializeConfig(e){const t=this.defaultConfig,r=e.getConfig()[this.pluginId]||{};this.mergedConfig=R(t,r,{arrayMerge:(s,c)=>c,clone:!0})}getCurrentConfig(){if(!this.mergedConfig)throw new Error("Plugin configuration has not been initialized");return this.mergedConfig}getData(){return Object.keys(this.data).length>0?this.data:void 0}init(e){if(this.initializeConfig(e),this.pluginInit)return this.pluginInit(this,e,this.getCurrentConfig())}createInterface(e={}){return{id:this.pluginId,init:t=>this.init(t),getConfig:()=>this.getCurrentConfig(),getData:()=>this.getData(),...e}}}const _=o=>{const e=document.querySelector(`script[src$="${o}.js"], script[src$="${o}.min.js"], script[src$="${o}.mjs"]`);if(e!=null&&e.src){const t=e.getAttribute("src")||"",r=t.lastIndexOf("/");if(r!==-1)return t.substring(0,r+1)}try{if(typeof{url:typeof document>"u"&&typeof location>"u"?require("url").pathToFileURL(__filename).href:typeof document>"u"?location.href:p&&p.tagName.toUpperCase()==="SCRIPT"&&p.src||new URL("plugin/copycode/copycode.js",document.baseURI).href}<"u"&&(typeof document>"u"&&typeof location>"u"?require("url").pathToFileURL(__filename).href:typeof document>"u"?location.href:p&&p.tagName.toUpperCase()==="SCRIPT"&&p.src||new URL("plugin/copycode/copycode.js",document.baseURI).href))return(typeof document>"u"&&typeof location>"u"?require("url").pathToFileURL(__filename).href:typeof document>"u"?location.href:p&&p.tagName.toUpperCase()==="SCRIPT"&&p.src||new URL("plugin/copycode/copycode.js",document.baseURI).href).slice(0,(typeof document>"u"&&typeof location>"u"?require("url").pathToFileURL(__filename).href:typeof document>"u"?location.href:p&&p.tagName.toUpperCase()==="SCRIPT"&&p.src||new URL("plugin/copycode/copycode.js",document.baseURI).href).lastIndexOf("/")+1)}catch{}return`plugin/${o}/`},M="data-css-id",N=(o,e)=>new Promise((t,r)=>{const s=document.createElement("link");s.rel="stylesheet",s.href=e,s.setAttribute(M,o);const c=setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s),r(new Error(`[${o}] Timeout loading CSS from: ${e}`))},5e3);s.onload=()=>{clearTimeout(c),t()},s.onerror=()=>{clearTimeout(c),s.parentNode&&s.parentNode.removeChild(s),r(new Error(`[${o}] Failed to load CSS from: ${e}`))},document.head.appendChild(s)}),H=o=>document.querySelectorAll(`[${M}="${o}"]`).length>0,B=async o=>{const{id:e,cssautoload:t=!0,csspath:r="",debug:s=!1}=o;if(t===!1||r===!1)return;if(H(e)){s&&console.log(`[${e}] CSS already loaded, skipping`);return}const c=[];typeof r=="string"&&r.trim()!==""&&c.push(r);const h=_(e);if(h){const m=`${h}${e}.css`;c.push(m)}const u=`plugin/${e}/${e}.css`;c.push(u);for(const m of c)try{await N(e,m);let d="CSS";r&&m===r?d="user-specified CSS":h&&m===`${h}${e}.css`?d="CSS (auto-detected from script location)":d="CSS (standard fallback)",s&&console.log(`[${e}] ${d} loaded successfully from: ${m}`);return}catch{s&&console.log(`[${e}] Failed to load CSS from: ${m}`)}console.warn(`[${e}] Could not load CSS from any location`)};class F{constructor(){b(this,"debugMode",!1),b(this,"label","DEBUG"),b(this,"groupDepth",0),b(this,"group",(...e)=>{this.debugLog("group",...e),this.groupDepth++}),b(this,"groupCollapsed",(...e)=>{this.debugLog("groupCollapsed",...e),this.groupDepth++}),b(this,"groupEnd",()=>{this.groupDepth>0&&(this.groupDepth--,this.debugLog("groupEnd"))}),b(this,"error",(...e)=>{const t=this.debugMode;this.debugMode=!0,this.formatAndLog(console.error,e),this.debugMode=t}),b(this,"table",(e,t,r)=>{if(this.debugMode)try{typeof e=="string"&&t!==void 0&&typeof t!="string"?(this.groupDepth===0?console.log(`[${this.label}]: ${e}`):console.log(e),r?console.table(t,r):console.table(t)):(this.groupDepth===0&&console.log(`[${this.label}]: Table data`),typeof t=="object"&&Array.isArray(t)?console.table(e,t):console.table(e))}catch(s){console.error(`[${this.label}]: Error showing table:`,s),console.log(`[${this.label}]: Raw data:`,e)}}),b(this,"formatAndLog",(e,t)=>{if(this.debugMode)try{this.groupDepth>0?e.call(console,...t):t.length>0&&typeof t[0]=="string"?e.call(console,`[${this.label}]: ${t[0]}`,...t.slice(1)):e.call(console,`[${this.label}]:`,...t)}catch(r){console.error(`[${this.label}]: Error in logging:`,r),console.log(`[${this.label}]: Original log data:`,...t)}})}initialize(e,t="DEBUG"){this.debugMode=e,this.label=t}debugLog(e,...t){const r=console[e];if(!this.debugMode&&e!=="error"||typeof r!="function")return;const s=r;if(e==="group"||e==="groupCollapsed"){t.length>0&&typeof t[0]=="string"?s.call(console,`[${this.label}]: ${t[0]}`,...t.slice(1)):s.call(console,`[${this.label}]:`,...t);return}if(e==="groupEnd"){s.call(console);return}if(e==="table"){t.length===1?this.table(t[0]):t.length===2?typeof t[0]=="string"?this.table(t[0],t[1]):this.table(t[0],t[1]):t.length>=3&&this.table(t[0],t[1],t[2]);return}this.groupDepth>0?s.call(console,...t):t.length>0&&typeof t[0]=="string"?s.call(console,`[${this.label}]: ${t[0]}`,...t.slice(1)):s.call(console,`[${this.label}]:`,...t)}}function z(o){return new Proxy(o,{get:(e,t)=>{if(t in e)return e[t];const r=t.toString();if(typeof console[r]=="function")return(...s)=>{e.debugLog(r,...s)}}})}const T=z(new F),k=(o,e)=>{const t=(r,s)=>r===void 0||r===""&&String(s)==="0"?!1:String(r)!==String(s);t(e.style.copybg,g.style.copybg)&&o.style.setProperty("--cc-copy-bg",e.style.copybg),t(e.style.copiedbg,g.style.copiedbg)&&o.style.setProperty("--cc-copied-bg",e.style.copiedbg),t(e.style.copycolor,g.style.copycolor)&&o.style.setProperty("--cc-copy-color",e.style.copycolor),t(e.style.copiedcolor,g.style.copiedcolor)&&o.style.setProperty("--cc-copied-color",e.style.copiedcolor),t(e.style.scale,g.style.scale)&&o.style.setProperty("--cc-scale",String(e.style.scale)),t(e.style.offset,g.style.offset)&&o.style.setProperty("--cc-offset",String(e.style.offset)),t(e.style.radius,g.style.radius)&&o.style.setProperty("--cc-radius",String(e.style.radius)),t(e.style.copyborder,g.style.copyborder)&&e.style.copyborder!==""&&o.style.setProperty("--cc-copyborder",e.style.copyborder),t(e.style.copiedborder,g.style.copiedborder)&&e.style.copiedborder!==""&&o.style.setProperty("--cc-copiedborder",e.style.copiedborder)},L={copy:'<svg aria-hidden="true" height="16" width="16" viewBox="0 0 16 16" version="1.1"><path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path></svg>',copied:'<svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16"><path d="M15.7,2.8c0.4,0.4,0.4,1,0,1.4L6,13.9c-0.4,0.4-1,0.4-1.4,0L0.3,9.6c-0.4-0.4-0.4-1,0-1.4c0.4-0.4,1-0.4,1.4,0l3.6,3.6l9-9C14.7,2.4,15.3,2.4,15.7,2.8z"/></svg>'},G=(o,e)=>{var c,h,u;const t=(c=e.iconsvg)!=null&&c.copy&&e.iconsvg.copy!==""?e.iconsvg.copy:L.copy,r=(h=e.iconsvg)!=null&&h.copied&&e.iconsvg.copied!==""?e.iconsvg.copied:L.copied,s=o.dataset.ccDisplay||e.display;s==="icons"||s==="both"?(o.innerHTML="<span></span>",o.textholder=o.querySelector("span"),o.insertAdjacentHTML("afterbegin",r),o.insertAdjacentHTML("afterbegin",t),o.dataset.ccDisplay==="icons"&&e.tooltip&&(o.textholder.style.display="flex")):(o.innerHTML="<span></span>",o.textholder=o.querySelector("span")),o.textholder&&(o.textholder.textContent=o.dataset.ccCopy?o.dataset.ccCopy:((u=e.text)==null?void 0:u.copy)||"Copy")},Z=async(o,e)=>{if(e.plaintextonly){let t;const r=o.querySelector("table.hljs-ln");r?t=Array.from(r.querySelectorAll("td.hljs-ln-code")).map(s=>s.textContent).join(`
`):t=o.innerText.replace(/^\s+|\s+$/g,""),await navigator.clipboard.writeText(t)}else try{const t=o.cloneNode(!0);let r;const s=t.querySelector("table.hljs-ln");if(s){const a=s.querySelectorAll("td.hljs-ln-numbers");for(const f of a)f.style.display="none";r=Array.from(s.querySelectorAll("td.hljs-ln-code")).map(f=>f.textContent).join(`
`)}else r=t.innerText;const h=`
				<style>
					${Array.from(document.styleSheets).flatMap(a=>{try{return Array.from(a.cssRules)}catch{return[]}}).filter(a=>a.cssText.includes(".hljs")||a.cssText.includes("pre code")||a.cssText.includes("code[class")||a.cssText.includes(".language-")||a.cssText.includes("pre")||a.cssText.includes("code")).map(a=>a.cssText).join(`
`)}
					pre, code, .hljs, .hljs-ln-code {
						white-space: pre !important;
						font-family: monospace !important;
					}
				</style>
				<div>
					${t.outerHTML}
				</div>
			`,u=new Blob([h],{type:"text/html"}),m=new Blob([r],{type:"text/plain"}),d=new ClipboardItem({"text/html":u,"text/plain":m});await navigator.clipboard.write([d])}catch(t){console.error("Rich text clipboard error:",t),await navigator.clipboard.writeText(o.innerText)}},K=o=>{const e=document.querySelectorAll(".codeblock > button:not(.code-copy-button)");for(const t of e)t.addEventListener("click",async()=>{console.log("Button clicked");const r=t,s=r.nextElementSibling;if(!s||!(s instanceof HTMLElement)){console.error("Could not find pre element");return}const c=s.querySelector("code");if(!c||!(c instanceof HTMLElement)){console.error("Could not find code element");return}try{console.log("Attempting to copy from:",c),await Z(c,o),console.log("doClipboard completed successfully"),Y(r,o)}catch(h){console.error("Error copying code:",h)}})},Y=(o,e)=>{o.textholder&&(o.dataset.textOriginal=o.textholder.innerHTML,o.textholder.innerHTML=o.dataset.ccCopied||e.text.copied),o.setAttribute("disabled","true"),setTimeout(()=>{o.textholder&&(o.dataset.ccDisplay!=="icons"||!o.dataset.ccDisplay)&&(o.textholder.innerHTML=o.dataset.textOriginal||""),delete o.dataset.textOriginal,o.removeAttribute("disabled")},e.timeout)},J=async(o,e,t)=>{var m;const r=e.getRevealElement(),s='pre:not([data-cc="false"]) > code',c=document.querySelector("[name=generator]"),h=((m=c==null?void 0:c.getAttribute("content"))==null?void 0:m.includes("quarto"))??!1;let u=[];if(r&&(k(r,t),u=Array.from(r.querySelectorAll(s)).map(d=>d.parentElement).filter(d=>d instanceof HTMLPreElement)),u.length>0){T.log(`${u.length} code blocks found`,u);for(const d of u){let a=null,f=null;const C=d.parentElement;if(h&&(C!=null&&C.matches(".sourceCode"))?(a=C,f=a,C.dataset.did="quartoblock"):(f=d,C!=null&&C.classList.contains("codeblock")||(a=document.createElement("div"),C==null||C.insertBefore(a,d))),a&&f){a.classList.add("codeblock"),a.appendChild(d),(t.display==="icon"||t.display==="icons"||t.display==="both")&&f&&(f.dataset.ccDisplay=t.display),d.classList.contains("fragment")&&(a.classList.add("fragment"),d.classList.remove("fragment"));const j=document.createElement("button");j.dataset.cc="true",j.title="Copy to Clipboard",t.button!=="always"&&(j.dataset.cc=t.button);const A=["cc","ccCopy","ccCopied","ccDisplay"];for(const w of A)f.dataset[w]&&(j.dataset[w]=f.dataset[w],delete f.dataset[w]);const x=d.querySelectorAll("code")[0];x!=null&&x.innerText&&(G(j,t),a.insertBefore(j,d))}}K(t)}},E="copycode",Q=async(o,e,t)=>{if(T&&t.debug&&T.initialize(!0,E),t.cssautoload)try{await B({id:o.pluginId,cssautoload:t.cssautoload,csspath:t.csspath,debug:t.debug})}catch(r){T.warn("CSS loading failed, but plugin will continue:",r)}await J(o,e,t)};return()=>new P(E,Q,g).createInterface()});
